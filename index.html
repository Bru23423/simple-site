<link rel="icon" href="favicon_bricklogo.png" type="image/png">
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POS + Kitchen Order Manager (DEMO ONLY)</title>
  <style>
    :root{
      --bg:#070a10;
      --panel:#0f172a;
      --panel2:#0b1223;
      --text:#e5e7eb;
      --muted:#93a4bf;
      --border:#24324a;
      --accent:#60a5fa;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html{overflow-y:scroll}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1000px 700px at 15% 0%, #12224a 0%, var(--bg) 60%);
      color:var(--text);
      min-height:100vh;
    }
    .topbar{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(7,10,16,.88), rgba(7,10,16,.65));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .topbar-inner{
      max-width: 1360px;
      margin:0 auto;
      padding: 12px 16px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:950; letter-spacing:.2px;}
    .dot{
      width:12px; height:12px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(96,165,250,.15);
    }
    .sub{
      color:var(--muted); font-weight:850; font-size:12px;
      border:1px solid rgba(255,255,255,.10);
      padding:6px 10px; border-radius:999px;
      background: rgba(255,255,255,.02);
      white-space:nowrap;
    }
    .tools{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    input[type="search"], select, input[type="text"], input[type="number"]{
      padding: 10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,23,42,.60);
      color: var(--text);
      outline:none;
    }
    textarea{
      width:100%;
      padding: 10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,23,42,.60);
      color: var(--text);
      outline:none;
      resize:vertical;
      min-height: 110px;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(96,165,250,.9);
      box-shadow: 0 0 0 4px rgba(96,165,250,.15);
    }
    .seg{
      display:flex;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 12px;
      overflow:hidden;
    }
    .seg button{
      border:0; background:transparent; color:var(--muted);
      padding:10px 12px; cursor:pointer; font-weight:950;
    }
    .seg button.active{color:#06101f; background: var(--accent);}
    .btn{
      border:0; cursor:pointer; font-weight:950;
      background: var(--accent);
      color:#06101f;
      padding:10px 12px;
      border-radius: 12px;
    }
    .btn.secondary{
      background: transparent;
      color: var(--text);
      border:1px solid rgba(255,255,255,.12);
    }
    .btn.bad{background: rgba(251,113,133,.95); color:#22040a;}
    .btn.good{background: rgba(52,211,153,.95); color:#02140c;}
    .btn.warn{background: rgba(251,191,36,.95); color:#1e1400;}
    .btn:disabled{opacity:.55; cursor:not-allowed;}

    .banner{
      max-width: 1360px;
      margin: 12px auto 0;
      padding: 0 16px;
    }
    .banner > div{
      border:1px solid rgba(251,191,36,.35);
      background: linear-gradient(180deg, rgba(251,191,36,.14), rgba(251,191,36,.06));
      border-radius: var(--radius);
      padding: 12px 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      color: #ffe8a3;
      font-weight:950;
      letter-spacing:.2px;
    }

    .wrap{
      max-width:1360px;
      margin: 12px auto 30px;
      padding: 0 16px;
      display:grid;
      grid-template-columns: 1.25fr .95fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){ .wrap{grid-template-columns: 1fr;} .right{position:static} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-h{
      padding: 14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.07);
      background: rgba(255,255,255,.02);
      flex-wrap:wrap;
    }
    .card-h h2{
      margin:0;
      font-size:14px;
      letter-spacing:.35px;
      text-transform:uppercase;
      color:#cfe1ff;
    }

    /* MENU */
    .menu{padding: 14px;}
    .cats{display:flex; gap:8px; flex-wrap:wrap; margin-bottom: 12px;}
    .chip{
      border:1px solid rgba(255,255,255,.10);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 999px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      font-weight:950;
      background: rgba(255,255,255,.03);
    }
    .chip.active{
      border-color: rgba(96,165,250,.55);
      color:#cfe1ff;
      box-shadow: 0 0 0 3px rgba(96,165,250,.12);
    }
    .grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;}
    @media (max-width: 980px){ .grid{grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 520px){ .grid{grid-template-columns: 1fr;} }
    .item{
      border:1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(11,18,35,.55);
      padding: 12px;
      cursor:pointer;
      transition: .12s ease;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:120px;
    }
    .item:hover{
      transform: translateY(-1px);
      border-color: rgba(96,165,250,.40);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    .t{display:flex; justify-content:space-between; gap:10px; align-items:flex-start;}
    .name{font-weight:1000}
    .price{color:#cfe1ff; font-weight:1000}
    .desc{color:var(--muted); font-size:12px; line-height:1.35}
    .tagrow{display:flex; gap:6px; flex-wrap:wrap; margin-top:auto}
    .tag{
      font-size:11px;
      padding:5px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      color: var(--muted);
      background: rgba(255,255,255,.02);
    }

    /* RIGHT */
    .right{position: sticky; top: 74px; display:grid; gap:14px; align-self:start;}
    @media (max-width: 980px){ .right{position:static; top:auto;} }

    .mini{font-size:12px; color: var(--muted);}

    /* CART */
    .cart{padding: 12px 14px 14px;}
    .cart-top{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;}
    @media (max-width: 520px){ .cart-top{grid-template-columns: 1fr;} }
    .cartlist{display:grid; gap:8px; max-height: 230px; overflow:auto; padding-right: 4px;}
    .line{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,18,35,.55);
      border-radius: 14px;
      padding: 10px;
      display:grid; grid-template-columns: 1fr auto;
      gap:8px; align-items:center;
    }
    .meta{display:flex; flex-direction:column; gap:2px;}
    .meta .n{font-weight:1000}
    .meta .s{font-size:12px; color:var(--muted)}
    .qty{display:flex; align-items:center; gap:6px; flex-wrap:wrap; justify-content:flex-end;}
    .qty button{
      width:34px; height:34px;
      border-radius: 10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.02);
      color: var(--text);
      cursor:pointer;
      font-weight:1000;
    }
    .qty input{width:56px; text-align:center; padding:10px 8px; border-radius: 10px;}

    .sum{
      margin-top: 10px;
      border-top: 1px solid rgba(255,255,255,.07);
      padding-top: 10px;
      display:grid; gap:6px;
      font-size:13px; color: var(--muted);
    }
    .r{display:flex; justify-content:space-between; gap:10px;}
    .total{color: var(--text); font-weight:1000; font-size:14px; margin-top: 2px;}
    .cart-actions{margin-top: 12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}

    /* SETTINGS */
    .settings{padding: 12px 14px 14px;}
    .setgrid{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    @media (max-width: 520px){ .setgrid{grid-template-columns: 1fr;} }
    .toggle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,18,35,.55);
      padding: 10px;
      border-radius: 14px;
      margin-top:10px;
    }
    .toggle label{display:flex; align-items:center; gap:10px; cursor:pointer; user-select:none; font-weight:900;}

    /* QUEUE */
    .queue{padding: 14px;}
    .qtools{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom: 10px;}
    .orders{display:grid; gap:10px; max-height: 440px; overflow:auto; padding-right: 4px;}
    .order{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,18,35,.55);
      border-radius: 16px;
      padding: 12px;
      display:grid; gap:10px;
    }
    .order-top{display:flex; justify-content:space-between; gap:10px; align-items:flex-start; flex-wrap:wrap;}
    .oid{font-weight:1100; letter-spacing:.4px;}
    .badge{
      font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      color: var(--muted);
      font-weight:1000;
    }
    .b-new{border-color: rgba(96,165,250,.35); color:#cfe1ff;}
    .b-prog{border-color: rgba(251,191,36,.35); color: #ffe8a3;}
    .b-ready{border-color: rgba(52,211,153,.35); color: #b7ffe3;}
    .b-done{border-color: rgba(148,163,184,.30); color: var(--muted);}
    .olist{display:grid; gap:6px; padding-left: 14px; margin:0; color: var(--text); font-size:13px;}
    .order-actions{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
      border-top: 1px solid rgba(255,255,255,.07);
      padding-top: 10px;
    }

    /* MODALS */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index:100;
    }
    .modal{
      width: min(900px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      box-shadow: 0 30px 90px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modal-h{
      padding: 14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
      flex-wrap:wrap;
    }
    .modal-h .title{font-weight:1100}
    .modal-b{padding: 14px; display:grid; gap:12px;}
    .box{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,18,35,.55);
      border-radius: 14px;
      padding: 12px;
    }
    .box h3{margin:0 0 8px; font-size:12px; color:#cfe1ff; letter-spacing:.3px; text-transform:uppercase;}
    .row2{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    @media (max-width: 680px){ .row2{grid-template-columns:1fr;} }
    .modal-actions{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
      border-top: 1px solid rgba(255,255,255,.08);
      padding: 12px 14px;
      background: rgba(255,255,255,.02);
    }
    .receipt{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      white-space: pre-wrap;
      background: rgba(0,0,0,.25);
      border:1px dashed rgba(255,255,255,.18);
      border-radius: 14px;
      padding: 12px;
      color: #e9eefc;
      line-height:1.35;
      font-size:12px;
      max-height: 240px;
      overflow:auto;
    }
    .table{
      width:100%;
      border-collapse: collapse;
      font-size:13px;
    }
    .table th,.table td{
      text-align:left;
      padding:8px;
      border-bottom:1px solid rgba(255,255,255,.08);
      vertical-align:top;
    }
    .table th{color:#cfe1ff; font-weight:950;}
    .pill{
      display:inline-block;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      color: var(--muted);
      font-weight:900;
    }
    .pill.ok{border-color: rgba(52,211,153,.35); color:#b7ffe3;}
    .pill.no{border-color: rgba(251,113,133,.35); color:#ffb2c1;}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <span class="dot"></span>
        <span>POS + Kitchen Order Manager</span>
        <span class="sub">DEMO</span>
        <span class="sub" id="savePill">Saved</span>
      </div>
      <div class="tools">
        <input id="menuSearch" type="search" placeholder="Search menu‚Ä¶" />
        <div class="seg">
          <button id="viewPOS" class="active" type="button">POS</button>
          <button id="viewKitchen" type="button">Kitchen</button>
        </div>
        <button id="manageItemsBtn" class="btn secondary" type="button">Manage Items</button>
        <button id="manageCouponsBtn" class="btn secondary" type="button">Manage Coupons</button>
        <button id="exportBtn" class="btn secondary" type="button">Export</button>
        <button id="importBtn" class="btn secondary" type="button">Import</button>
        <button id="resetBtn" class="btn secondary" type="button">Reset Demo</button>
      </div>
    </div>
  </div>

  <div class="banner">
    <div>DO NOT APPLY ‚Äî TESTING ONLY / DEMO ONLY. This does not place real orders.</div>
  </div>

  <main class="wrap">
    <!-- MENU -->
    <section class="card" id="posPanel">
      <div class="card-h">
        <h2>Menu</h2>
        <div class="tools">
          <span class="sub" id="menuCount">0 items</span>
        </div>
      </div>
      <div class="menu">
        <div class="cats" id="cats"></div>
        <div class="grid" id="grid"></div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="right" id="posRight">
      <!-- CART -->
      <section class="card">
        <div class="card-h">
          <h2>Current Order</h2>
          <div class="tools">
            <span class="sub" id="cartCount">0 items</span>
          </div>
        </div>

        <div class="cart">
          <div class="cart-top">
            <div>
              <div class="mini">Order Type</div>
              <select id="orderType">
                <option>Dine-In</option>
                <option>Takeout</option>
                <option>Drive-Thru</option>
              </select>
            </div>
            <div>
              <div class="mini">Name / Ticket note (optional)</div>
              <input id="customerName" type="text" placeholder="e.g., Alex / Table 4" />
            </div>
          </div>

          <div style="display:grid; grid-template-columns: 1fr auto; gap:10px; margin-bottom:10px;">
            <div>
              <div class="mini">Coupon code (optional)</div>
              <input id="couponCode" type="text" placeholder="e.g., SAVE10" />
            </div>
            <div style="display:flex; align-items:flex-end; gap:8px;">
              <button class="btn secondary" id="applyCouponBtn" type="button">Apply</button>
              <button class="btn secondary" id="clearCouponBtn" type="button">Clear</button>
            </div>
          </div>
          <div class="mini" id="couponStatus">No coupon applied.</div>

          <div class="cartlist" id="cartlist"></div>

          <div class="sum">
            <div class="r"><span>Subtotal</span><span id="sub">$0.00</span></div>
            <div class="r"><span id="discountLabel">Discount</span><span id="discount">-$0.00</span></div>
            <div class="r"><span id="taxLabel">Tax</span><span id="tax">$0.00</span></div>
            <div class="r"><span id="feeLabel">Service fee</span><span id="fee">$0.00</span></div>
            <div class="r total"><span>Total</span><span id="total">$0.00</span></div>
          </div>

          <div class="cart-actions">
            <button class="btn secondary" id="receiptCartBtn" type="button">Receipt</button>
            <button class="btn secondary" id="clearCartBtn" type="button">Clear</button>
            <button class="btn" id="placeOrderBtn" type="button" disabled>Place Order</button>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section class="card">
        <div class="card-h">
          <h2>Tax / Fees Settings</h2>
          <div class="tools">
            <span class="sub" id="settingsPill">Saved</span>
          </div>
        </div>
        <div class="settings">
          <div class="setgrid">
            <div>
              <div class="mini">Tax %</div>
              <input id="taxPct" type="number" step="0.01" min="0" max="25" />
            </div>
            <div>
              <div class="mini">Service Fee ($)</div>
              <input id="feeAmt" type="number" step="0.01" min="0" />
            </div>
          </div>

          <div class="toggle">
            <label><input id="dingOn" type="checkbox" /> Ding on new order</label>
            <div class="mini">Kitchen sound</div>
          </div>

          <div class="toggle">
            <label><input id="pauseOrders" type="checkbox" /> Pause placing orders</label>
            <div class="mini">Demo lock</div>
          </div>

          <div class="cart-actions" style="justify-content:space-between;">
            <button class="btn secondary" id="defaultSettingsBtn" type="button">Default</button>
            <button class="btn secondary" id="saveSettingsBtn" type="button">Save</button>
          </div>
        </div>
      </section>

      <!-- QUEUE -->
      <section class="card">
        <div class="card-h">
          <h2>Order Queue</h2>
          <div class="tools">
            <span class="sub" id="queueCount">0</span>
          </div>
        </div>
        <div class="queue">
          <div class="qtools">
            <input id="orderSearch" type="search" placeholder="Search #ID / name / item‚Ä¶" />
            <select id="filterStatus">
              <option value="all">All</option>
              <option value="new">New</option>
              <option value="progress">In Progress</option>
              <option value="ready">Ready</option>
              <option value="done">Completed</option>
            </select>
            <button class="btn secondary" id="clearCompletedBtn" type="button">Clear Completed</button>
          </div>
          <div class="orders" id="orders"></div>
        </div>
      </section>
    </aside>

    <!-- KITCHEN VIEW -->
    <section class="card" id="kitchenPanel" style="display:none;">
      <div class="card-h">
        <h2>Kitchen Display</h2>
        <div class="tools">
          <span class="sub">Approve ‚úÖ / Clear üóëÔ∏è</span>
        </div>
      </div>
      <div class="queue">
        <div class="qtools">
          <select id="kFilter">
            <option value="kitchen">Kitchen (New + In Progress)</option>
            <option value="ready">Ready only</option>
            <option value="all">All</option>
          </select>
        </div>
        <div class="orders" id="kOrders" style="max-height: calc(100vh - 220px);"></div>
      </div>
    </section>
  </main>

  <!-- ITEM CUSTOMIZE MODAL (simple note + qty) -->
  <div class="modal-backdrop" id="customizeBg" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-h">
        <div>
          <div class="title" id="cTitle">Item</div>
          <div class="mini" id="cSub">Customize (demo)</div>
        </div>
        <button class="btn secondary" id="cClose" type="button">Close</button>
      </div>
      <div class="modal-b">
        <div class="box">
          <h3>Quantity</h3>
          <input id="cQty" type="number" min="1" value="1" />
        </div>
        <div class="box">
          <h3>Notes</h3>
          <input id="cNote" type="text" placeholder="e.g., no pickles, extra sauce" />
          <div class="mini" style="margin-top:8px;">Notes show on kitchen tickets + receipts.</div>
        </div>
        <div class="box">
          <h3>Preview</h3>
          <div class="receipt" id="cPreview"></div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn secondary" id="cCancel" type="button">Cancel</button>
        <button class="btn good" id="cAdd" type="button">Add</button>
      </div>
    </div>
  </div>

  <!-- MANAGE ITEMS MODAL -->
  <div class="modal-backdrop" id="itemsBg" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-h">
        <div>
          <div class="title">Manage Menu Items</div>
          <div class="mini">Add your own items (saved locally).</div>
        </div>
        <button class="btn secondary" id="itemsClose" type="button">Close</button>
      </div>
      <div class="modal-b">
        <div class="box">
          <h3>Add / Edit Item</h3>
          <div class="row2">
            <div>
              <div class="mini">ID (auto if blank)</div>
              <input id="miId" type="text" placeholder="e.g., my-burger-1" />
            </div>
            <div>
              <div class="mini">Category</div>
              <input id="miCat" type="text" placeholder="e.g., Burgers" />
            </div>
            <div>
              <div class="mini">Name</div>
              <input id="miName" type="text" placeholder="e.g., Mega Burger" />
            </div>
            <div>
              <div class="mini">Price</div>
              <input id="miPrice" type="number" step="0.01" min="0" placeholder="5.99" />
            </div>
          </div>
          <div style="margin-top:10px;">
            <div class="mini">Description</div>
            <input id="miDesc" type="text" placeholder="Short description" />
          </div>
          <div style="margin-top:10px;">
            <span class="mini">This saves to your browser only.</span>
          </div>
          <div class="modal-actions" style="border-top:0; padding:10px 0 0;">
            <button class="btn secondary" id="miClear" type="button">Clear</button>
            <button class="btn good" id="miSave" type="button">Save Item</button>
          </div>
        </div>

        <div class="box">
          <h3>Current Menu Items</h3>
          <div class="mini" style="margin-bottom:8px;">Tip: Click ‚ÄúEdit‚Äù to load into the form.</div>
          <div style="max-height:240px; overflow:auto; border:1px solid rgba(255,255,255,.08); border-radius:14px;">
            <table class="table" id="menuTable"></table>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn warn" id="seedMenu" type="button">Restore Default Menu</button>
        <button class="btn bad" id="wipeCustomMenu" type="button">Delete ALL Custom Items</button>
      </div>
    </div>
  </div>

  <!-- MANAGE COUPONS MODAL -->
  <div class="modal-backdrop" id="couponsBg" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-h">
        <div>
          <div class="title">Manage Coupons</div>
          <div class="mini">Create coupon codes like SAVE10 or OFF2 (saved locally).</div>
        </div>
        <button class="btn secondary" id="couponsClose" type="button">Close</button>
      </div>
      <div class="modal-b">
        <div class="box">
          <h3>Add / Edit Coupon</h3>
          <div class="row2">
            <div>
              <div class="mini">Code (required)</div>
              <input id="cpCode" type="text" placeholder="SAVE10" />
            </div>
            <div>
              <div class="mini">Type</div>
              <select id="cpType">
                <option value="percent">Percent %</option>
                <option value="fixed">Fixed $</option>
              </select>
            </div>
            <div>
              <div class="mini">Value</div>
              <input id="cpValue" type="number" step="0.01" min="0" placeholder="10" />
            </div>
            <div>
              <div class="mini">Min Subtotal ($) (optional)</div>
              <input id="cpMin" type="number" step="0.01" min="0" placeholder="0" />
            </div>
          </div>
          <div style="margin-top:10px;">
            <div class="mini">Active?</div>
            <select id="cpActive">
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>

          <div class="modal-actions" style="border-top:0; padding:10px 0 0;">
            <button class="btn secondary" id="cpClear" type="button">Clear</button>
            <button class="btn good" id="cpSave" type="button">Save Coupon</button>
          </div>
        </div>

        <div class="box">
          <h3>Current Coupons</h3>
          <div style="max-height:240px; overflow:auto; border:1px solid rgba(255,255,255,.08); border-radius:14px;">
            <table class="table" id="couponTable"></table>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn warn" id="seedCoupons" type="button">Restore Sample Coupons</button>
        <button class="btn bad" id="wipeCoupons" type="button">Delete ALL Coupons</button>
      </div>
    </div>
  </div>

  <!-- EXPORT/IMPORT MODAL -->
  <div class="modal-backdrop" id="dataBg" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-h">
        <div>
          <div class="title">Export / Import</div>
          <div class="mini">Backup your demo data (JSON).</div>
        </div>
        <button class="btn secondary" id="dataClose" type="button">Close</button>
      </div>
      <div class="modal-b">
        <div class="box">
          <h3>JSON</h3>
          <textarea id="dataBox" placeholder="Export will appear here‚Ä¶"></textarea>
          <div class="mini" style="margin-top:8px;">Import replaces your saved demo data.</div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn secondary" id="doExport" type="button">Fill Export</button>
        <button class="btn bad" id="doImport" type="button">Import (Replace)</button>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // STORAGE
    // =========================
    const STORE = {
      menu: "demo_pos_menu_v1",
      coupons: "demo_pos_coupons_v1",
      cart: "demo_pos_cart_v1",
      orders: "demo_pos_orders_v1",
      settings: "demo_pos_settings_v1",
      counter: "demo_pos_counter_v1",
      ui: "demo_pos_ui_v1"
    };

    // =========================
    // DEFAULT DATA (seed)
    // =========================
    const DEFAULT_MENU = [
      {id:"b1", cat:"Burgers", name:"Classic Burger", price:4.99, desc:"Beef, lettuce, pickles, sauce."},
      {id:"b2", cat:"Burgers", name:"Cheeseburger", price:5.49, desc:"Classic + cheese."},
      {id:"c1", cat:"Chicken", name:"Crispy Chicken Sandwich", price:5.99, desc:"Crispy chicken, mayo, pickles."},
      {id:"c2", cat:"Chicken", name:"Nuggets (6pc)", price:4.49, desc:"6 nuggets with dipping sauce."},
      {id:"f1", cat:"Fries", name:"Fries", price:2.19, desc:"Golden fries, lightly salted."},
      {id:"d1", cat:"Drinks", name:"Soft Drink", price:1.79, desc:"Choose your flavor (demo)."},
      {id:"d2", cat:"Drinks", name:"Iced Coffee", price:2.99, desc:"Sweet, smooth, chilled."},
      {id:"s1", cat:"Desserts", name:"Ice Cream Cone", price:1.69, desc:"Classic soft-serve cone."},
      {id:"s2", cat:"Desserts", name:"Cookie", price:1.29, desc:"Baked cookie (demo)."},
    ];

    const SAMPLE_COUPONS = [
      {code:"SAVE10", type:"percent", value:10, min:0, active:true},
      {code:"OFF2", type:"fixed", value:2.00, min:10, active:true},
      {code:"BIGSAVE", type:"percent", value:15, min:25, active:false},
    ];

    // =========================
    // STATE
    // =========================
    let menu = loadJson(STORE.menu, null);
    if(!Array.isArray(menu) || !menu.length){
      menu = structuredClone(DEFAULT_MENU);
      saveJson(STORE.menu, menu);
    }

    let coupons = loadJson(STORE.coupons, null);
    if(!Array.isArray(coupons) || !coupons.length){
      coupons = structuredClone(SAMPLE_COUPONS);
      saveJson(STORE.coupons, coupons);
    }

    let cart = loadJson(STORE.cart, []); // [{key,id,name,price,qty,note}]
    let orders = loadJson(STORE.orders, []);
    let counter = loadJson(STORE.counter, 1000);

    let settings = loadJson(STORE.settings, {
      taxPct: 8.00,
      feeAmt: 0.00,
      dingOn: true,
      pauseOrders: false
    });

    let ui = loadJson(STORE.ui, {orderType:"Dine-In", customer:"", coupon:{code:"", applied:null}});

    let cat = "All";
    let menuSearch = "";

    // =========================
    // ELEMENTS
    // =========================
    const savePill = document.getElementById("savePill");
    const menuCount = document.getElementById("menuCount");
    const catsEl = document.getElementById("cats");
    const gridEl = document.getElementById("grid");
    const menuSearchEl = document.getElementById("menuSearch");

    const cartCount = document.getElementById("cartCount");
    const cartList = document.getElementById("cartlist");
    const subEl = document.getElementById("sub");
    const discountEl = document.getElementById("discount");
    const taxEl = document.getElementById("tax");
    const feeEl = document.getElementById("fee");
    const totalEl = document.getElementById("total");
    const discountLabel = document.getElementById("discountLabel");
    const taxLabel = document.getElementById("taxLabel");
    const feeLabel = document.getElementById("feeLabel");

    const orderTypeEl = document.getElementById("orderType");
    const customerEl = document.getElementById("customerName");
    const couponCodeEl = document.getElementById("couponCode");
    const couponStatusEl = document.getElementById("couponStatus");

    const applyCouponBtn = document.getElementById("applyCouponBtn");
    const clearCouponBtn = document.getElementById("clearCouponBtn");

    const placeOrderBtn = document.getElementById("placeOrderBtn");
    const clearCartBtn = document.getElementById("clearCartBtn");
    const receiptCartBtn = document.getElementById("receiptCartBtn");

    const taxPctEl = document.getElementById("taxPct");
    const feeAmtEl = document.getElementById("feeAmt");
    const dingOnEl = document.getElementById("dingOn");
    const pauseOrdersEl = document.getElementById("pauseOrders");
    const defaultSettingsBtn = document.getElementById("defaultSettingsBtn");
    const saveSettingsBtn = document.getElementById("saveSettingsBtn");
    const settingsPill = document.getElementById("settingsPill");

    const queueCount = document.getElementById("queueCount");
    const ordersEl = document.getElementById("orders");
    const filterStatusEl = document.getElementById("filterStatus");
    const orderSearchEl = document.getElementById("orderSearch");
    const clearCompletedBtn = document.getElementById("clearCompletedBtn");

    const viewPOS = document.getElementById("viewPOS");
    const viewKitchen = document.getElementById("viewKitchen");
    const posPanel = document.getElementById("posPanel");
    const posRight = document.getElementById("posRight");
    const kitchenPanel = document.getElementById("kitchenPanel");
    const kFilterEl = document.getElementById("kFilter");
    const kOrdersEl = document.getElementById("kOrders");

    const manageItemsBtn = document.getElementById("manageItemsBtn");
    const manageCouponsBtn = document.getElementById("manageCouponsBtn");
    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const resetBtn = document.getElementById("resetBtn");

    // Customize modal
    const customizeBg = document.getElementById("customizeBg");
    const cTitle = document.getElementById("cTitle");
    const cSub = document.getElementById("cSub");
    const cQty = document.getElementById("cQty");
    const cNote = document.getElementById("cNote");
    const cPreview = document.getElementById("cPreview");
    const cClose = document.getElementById("cClose");
    const cCancel = document.getElementById("cCancel");
    const cAdd = document.getElementById("cAdd");
    let customizeItem = null;

    // Items modal
    const itemsBg = document.getElementById("itemsBg");
    const itemsClose = document.getElementById("itemsClose");
    const miId = document.getElementById("miId");
    const miCat = document.getElementById("miCat");
    const miName = document.getElementById("miName");
    const miPrice = document.getElementById("miPrice");
    const miDesc = document.getElementById("miDesc");
    const miClear = document.getElementById("miClear");
    const miSave = document.getElementById("miSave");
    const menuTable = document.getElementById("menuTable");
    const seedMenu = document.getElementById("seedMenu");
    const wipeCustomMenu = document.getElementById("wipeCustomMenu");

    // Coupons modal
    const couponsBg = document.getElementById("couponsBg");
    const couponsClose = document.getElementById("couponsClose");
    const cpCode = document.getElementById("cpCode");
    const cpType = document.getElementById("cpType");
    const cpValue = document.getElementById("cpValue");
    const cpMin = document.getElementById("cpMin");
    const cpActive = document.getElementById("cpActive");
    const cpClear = document.getElementById("cpClear");
    const cpSave = document.getElementById("cpSave");
    const couponTable = document.getElementById("couponTable");
    const seedCoupons = document.getElementById("seedCoupons");
    const wipeCoupons = document.getElementById("wipeCoupons");

    // Export/import modal
    const dataBg = document.getElementById("dataBg");
    const dataClose = document.getElementById("dataClose");
    const dataBox = document.getElementById("dataBox");
    const doExport = document.getElementById("doExport");
    const doImport = document.getElementById("doImport");

    // =========================
    // HELPERS
    // =========================
    const money = n => "$" + Number(n).toFixed(2);

    function loadJson(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : fallback;
      }catch{
        return fallback;
      }
    }
    function saveJson(key, value){
      localStorage.setItem(key, JSON.stringify(value));
      pulseSaved();
    }
    function pulseSaved(){
      savePill.textContent = "Saved";
      savePill.style.borderColor = "rgba(52,211,153,.35)";
      savePill.style.color = "#b7ffe3";
      clearTimeout(pulseSaved.t);
      pulseSaved.t = setTimeout(() => {
        savePill.style.borderColor = "rgba(255,255,255,.10)";
        savePill.style.color = "var(--muted)";
      }, 700);
    }
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function uid(prefix="id"){
      return (prefix + "-" + Math.random().toString(36).slice(2,10));
    }
    function nowTime(){
      return new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
    }

    // ding
    function ding(){
      if(!settings.dingOn) return;
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.setValueAtTime(880, ctx.currentTime);
        g.gain.setValueAtTime(0.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.18);
        o.connect(g); g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + 0.20);
      }catch{}
    }

    // =========================
    // COUPONS
    // =========================
    function normalizeCode(code){
      return String(code||"").trim().toUpperCase();
    }
    function findCoupon(code){
      const c = normalizeCode(code);
      return coupons.find(x => normalizeCode(x.code) === c) || null;
    }

    function couponDiscountForSubtotal(subtotal){
      const applied = ui.coupon?.applied;
      if(!applied) return {amount:0, label:"Discount", ok:false, reason:"No coupon applied"};
      const c = findCoupon(applied.code);
      if(!c) return {amount:0, label:"Discount", ok:false, reason:"Coupon not found"};
      if(!c.active) return {amount:0, label:"Discount", ok:false, reason:"Coupon inactive"};
      const min = Math.max(0, Number(c.min||0));
      if(subtotal < min) return {amount:0, label:"Discount", ok:false, reason:`Min $${min.toFixed(2)} not met`};

      let amount = 0;
      if(c.type === "percent"){
        const pct = Math.max(0, Math.min(100, Number(c.value||0)));
        amount = subtotal * (pct/100);
        return {amount, label:`Coupon ${normalizeCode(c.code)} (-${pct.toFixed(0)}%)`, ok:true, reason:""};
      } else {
        const fixed = Math.max(0, Number(c.value||0));
        amount = fixed;
        return {amount, label:`Coupon ${normalizeCode(c.code)} (-${money(fixed)})`, ok:true, reason:""};
      }
    }

    function applyCoupon(){
      const code = normalizeCode(couponCodeEl.value);
      if(!code){
        ui.coupon = {code:"", applied:null};
        saveJson(STORE.ui, ui);
        renderCart();
        return;
      }
      const c = findCoupon(code);
      if(!c){
        couponStatusEl.textContent = "Coupon not found.";
        couponStatusEl.style.color = "var(--bad)";
        return;
      }
      ui.coupon = {code, applied:{code}};
      saveJson(STORE.ui, ui);
      renderCart();
    }
    function clearCoupon(){
      ui.coupon = {code:"", applied:null};
      couponCodeEl.value = "";
      saveJson(STORE.ui, ui);
      renderCart();
    }

    // =========================
    // PRICING
    // =========================
    function calcCart(){
      let subtotal = 0;
      let itemCount = 0;
      const lines = cart.map(li => {
        const line = li.price * li.qty;
        subtotal += line;
        itemCount += li.qty;
        return {...li, line};
      });

      const couponInfo = couponDiscountForSubtotal(subtotal);
      const discount = Math.min(subtotal, Math.max(0, couponInfo.amount));

      const taxRate = Math.max(0, Number(settings.taxPct||0))/100;
      const fee = Math.max(0, Number(settings.feeAmt||0));

      const taxable = Math.max(0, subtotal - discount);
      const tax = taxable * taxRate;
      const total = taxable + tax + fee;

      return {lines, subtotal, discount, couponInfo, tax, fee, total, itemCount};
    }

    // =========================
    // RENDER MENU
    // =========================
    function renderCats(){
      const cats = ["All", ...Array.from(new Set(menu.map(m=>m.cat))).sort((a,b)=>a.localeCompare(b))];
      catsEl.innerHTML = cats.map(c => `<div class="chip ${c===cat?"active":""}" data-cat="${escapeHtml(c)}">${escapeHtml(c)}</div>`).join("");
      catsEl.querySelectorAll(".chip").forEach(ch => {
        ch.addEventListener("click", () => {
          cat = ch.dataset.cat;
          renderMenu();
        });
      });
    }

    function filteredMenu(){
      const q = menuSearch.trim().toLowerCase();
      return menu.filter(m => {
        const inCat = (cat === "All") || (m.cat === cat);
        const inSearch = !q || (m.name.toLowerCase().includes(q) || (m.desc||"").toLowerCase().includes(q) || m.cat.toLowerCase().includes(q));
        return inCat && inSearch;
      });
    }

    function renderMenu(){
      const items = filteredMenu();
      menuCount.textContent = `${items.length} items`;
      gridEl.innerHTML = items.map(m => `
        <div class="item" data-id="${escapeHtml(m.id)}">
          <div class="t">
            <div class="name">${escapeHtml(m.name)}</div>
            <div class="price">${money(m.price)}</div>
          </div>
          <div class="desc">${escapeHtml(m.desc||"")}</div>
          <div class="tagrow">
            <span class="tag">${escapeHtml(m.cat)}</span>
            <span class="tag">Tap to add</span>
          </div>
        </div>
      `).join("");

      gridEl.querySelectorAll(".item").forEach(card => {
        card.addEventListener("click", () => openCustomize(card.dataset.id));
      });
    }

    // =========================
    // CUSTOMIZE MODAL
    // =========================
    function openCustomize(id){
      const item = menu.find(x => x.id === id);
      if(!item) return;
      customizeItem = item;
      cTitle.textContent = item.name;
      cSub.textContent = `${item.cat} ‚Ä¢ ${money(item.price)}`;
      cQty.value = 1;
      cNote.value = "";
      updateCustomizePreview();
      openModal(customizeBg);
    }
    function updateCustomizePreview(){
      if(!customizeItem) return;
      const qty = Math.max(1, parseInt(cQty.value||"1",10));
      const note = cNote.value.trim();
      const line = customizeItem.price * qty;
      cPreview.textContent =
`DEMO PREVIEW
--------------------
${customizeItem.name}
Qty: ${qty}
Unit: ${money(customizeItem.price)}
Line: ${money(line)}
${note ? "Note: "+note : ""}
--------------------`;
    }
    function addToCart(item, qty, note){
      const q = Math.max(1, qty|0);
      const n = (note||"").trim();
      // merge identical item+note
      const sig = JSON.stringify({id:item.id, note:n});
      const existing = cart.find(x => x.sig === sig);
      if(existing){
        existing.qty += q;
      }else{
        cart.push({key:uid("line"), sig, id:item.id, name:item.name, price:Number(item.price), qty:q, note:n});
      }
      saveJson(STORE.cart, cart);
      renderCart();
    }

    cQty.addEventListener("input", updateCustomizePreview);
    cNote.addEventListener("input", updateCustomizePreview);
    cClose.addEventListener("click", ()=>closeModal(customizeBg));
    cCancel.addEventListener("click", ()=>closeModal(customizeBg));
    customizeBg.addEventListener("click", (e)=>{ if(e.target===customizeBg) closeModal(customizeBg); });
    window.addEventListener("keydown", (e)=>{ if(e.key==="Escape"){ [customizeBg,itemsBg,couponsBg,dataBg].forEach(bg=>{ if(bg.style.display==="flex") closeModal(bg);}); }});

    cAdd.addEventListener("click", ()=>{
      if(!customizeItem) return;
      const qty = Math.max(1, parseInt(cQty.value||"1",10));
      const note = cNote.value.trim();
      addToCart(customizeItem, qty, note);
      closeModal(customizeBg);
    });

    // =========================
    // CART RENDER
    // =========================
    function renderCart(){
      const {lines, subtotal, discount, couponInfo, tax, fee, total, itemCount} = calcCart();

      cartCount.textContent = `${itemCount} items`;
      subEl.textContent = money(subtotal);
      discountEl.textContent = "-" + money(discount);
      taxEl.textContent = money(tax);
      feeEl.textContent = money(fee);
      totalEl.textContent = money(total);

      taxLabel.textContent = `Tax (${Number(settings.taxPct||0).toFixed(2)}%)`;
      feeLabel.textContent = `Service fee ($)`;
      discountLabel.textContent = couponInfo.label || "Discount";

      // coupon status
      if(ui.coupon?.applied?.code){
        couponCodeEl.value = ui.coupon.applied.code;
      }
      if(couponInfo.ok){
        couponStatusEl.innerHTML = `<span class="pill ok">Applied</span> ${escapeHtml(couponInfo.label)}`;
        couponStatusEl.style.color = "inherit";
      }else{
        if(ui.coupon?.applied?.code){
          couponStatusEl.innerHTML = `<span class="pill no">Not applied</span> ${escapeHtml(couponInfo.reason || "Coupon invalid")}`;
          couponStatusEl.style.color = "inherit";
        }else{
          couponStatusEl.textContent = "No coupon applied.";
          couponStatusEl.style.color = "var(--muted)";
        }
      }

      placeOrderBtn.disabled = lines.length === 0 || !!settings.pauseOrders;

      cartList.innerHTML = lines.length ? lines.map(li => `
        <div class="line" data-key="${li.key}">
          <div class="meta">
            <div class="n">${escapeHtml(li.name)}</div>
            <div class="s">${money(li.price)} ‚Ä¢ Line: ${money(li.line)}</div>
            ${li.note ? `<div class="mini">Note: ${escapeHtml(li.note)}</div>` : ``}
          </div>
          <div class="qty">
            <button type="button" data-act="dec">‚àí</button>
            <input type="number" min="1" value="${li.qty}" data-act="qty" />
            <button type="button" data-act="inc">+</button>
            <button type="button" data-act="del" title="Remove" style="border-color:rgba(251,113,133,.35)">‚úï</button>
          </div>
        </div>
      `).join("") : `<div class="mini">Cart is empty. Tap a menu item to add it.</div>`;

      cartList.querySelectorAll(".line").forEach(row => {
        const key = row.dataset.key;
        const li = cart.find(x => x.key === key);
        row.querySelectorAll("button").forEach(btn => {
          btn.addEventListener("click", () => {
            if(!li) return;
            const act = btn.dataset.act;
            if(act==="inc") li.qty += 1;
            if(act==="dec") li.qty = Math.max(1, li.qty - 1);
            if(act==="del") cart = cart.filter(x => x.key !== key);
            saveJson(STORE.cart, cart);
            renderCart();
          });
        });
        const qInput = row.querySelector('input[data-act="qty"]');
        qInput?.addEventListener("change", () => {
          if(!li) return;
          li.qty = Math.max(1, parseInt(qInput.value||"1",10));
          saveJson(STORE.cart, cart);
          renderCart();
        });
      });

      // persist UI fields
      ui.orderType = orderTypeEl.value;
      ui.customer = customerEl.value;
      saveJson(STORE.ui, ui);
    }

    // =========================
    // ORDERS
    // =========================
    function nextOrderId(){
      counter += 1;
      saveJson(STORE.counter, counter);
      return String(counter);
    }
    function setStatus(oid, status){
      const o = orders.find(x => x.oid === oid);
      if(!o) return;
      o.status = status;
      saveJson(STORE.orders, orders);
      renderQueue();
    }
    function deleteOrder(oid){
      orders = orders.filter(o => o.oid !== oid);
      saveJson(STORE.orders, orders);
      renderQueue();
    }
    function advanceStatus(oid, dir){
      const o = orders.find(x => x.oid === oid);
      if(!o) return;
      const flow = ["new","progress","ready","done"];
      let idx = flow.indexOf(o.status);
      idx = Math.max(0, Math.min(flow.length-1, idx + dir));
      o.status = flow[idx];
      saveJson(STORE.orders, orders);
      renderQueue();
    }
    function statusBadge(s){
      if(s==="new") return `<span class="badge b-new">NEW</span>`;
      if(s==="progress") return `<span class="badge b-prog">IN PROGRESS</span>`;
      if(s==="ready") return `<span class="badge b-ready">READY</span>`;
      return `<span class="badge b-done">COMPLETED</span>`;
    }

    function placeOrder(){
      if(settings.pauseOrders){
        alert("Orders are paused in settings (demo).");
        return;
      }
      const {lines, subtotal, discount, couponInfo, tax, fee, total} = calcCart();
      if(!lines.length) return;

      const oid = nextOrderId();
      const order = {
        oid,
        type: orderTypeEl.value,
        customer: customerEl.value.trim(),
        status: "new",
        time: nowTime(),
        createdAt: Date.now(),
        pricing: {
          subtotal, discount,
          coupon: couponInfo.ok ? (ui.coupon.applied.code) : "",
          taxPct: Number(settings.taxPct||0),
          tax, fee, total
        },
        items: lines.map(l => ({name:l.name, qty:l.qty, price:l.price, note:l.note||""}))
      };

      orders.push(order);
      saveJson(STORE.orders, orders);
      ding();

      // clear cart + coupon
      cart = [];
      saveJson(STORE.cart, cart);
      customerEl.value = "";
      clearCoupon();
      renderCart();
      renderQueue();
    }

    // =========================
    // RECEIPTS
    // =========================
    function buildReceiptTextForCart(){
      const {lines, subtotal, discount, couponInfo, tax, fee, total} = calcCart();
      const out = [];
      out.push("RECEIPT (DEMO ONLY)");
      out.push("--------------------------------");
      out.push(`Type: ${orderTypeEl.value}`);
      if(customerEl.value.trim()) out.push(`Note: ${customerEl.value.trim()}`);
      out.push("--------------------------------");
      for(const it of lines){
        out.push(`${String(it.qty).padStart(2," ")} x ${it.name} @ ${money(it.price)}`);
        if(it.note) out.push(`     Note: ${it.note}`);
      }
      out.push("--------------------------------");
      out.push(`Subtotal: ${money(subtotal)}`);
      out.push(`${couponInfo.label}: -${money(discount)}`);
      out.push(`Tax (${Number(settings.taxPct||0).toFixed(2)}%): ${money(tax)}`);
      out.push(`Fee: ${money(fee)}`);
      out.push("--------------------------------");
      out.push(`TOTAL: ${money(total)}`);
      out.push("--------------------------------");
      out.push("DEMO ONLY ‚Ä¢ NOT REAL");
      return out.join("\n");
    }
    function buildReceiptTextForOrder(o){
      const out = [];
      out.push("ORDER RECEIPT (DEMO ONLY)");
      out.push("--------------------------------");
      out.push(`Order #: ${o.oid}`);
      out.push(`Type: ${o.type}`);
      if(o.customer) out.push(`Note: ${o.customer}`);
      out.push(`Time: ${o.time}`);
      out.push("--------------------------------");
      for(const it of o.items){
        out.push(`${String(it.qty).padStart(2," ")} x ${it.name} @ ${money(it.price)}`);
        if(it.note) out.push(`     Note: ${it.note}`);
      }
      out.push("--------------------------------");
      out.push(`Subtotal: ${money(o.pricing.subtotal)}`);
      if(o.pricing.coupon) out.push(`Coupon ${o.pricing.coupon}: -${money(o.pricing.discount)}`);
      else out.push(`Discount: -${money(o.pricing.discount)}`);
      out.push(`Tax (${Number(o.pricing.taxPct||0).toFixed(2)}%): ${money(o.pricing.tax)}`);
      out.push(`Fee: ${money(o.pricing.fee)}`);
      out.push("--------------------------------");
      out.push(`TOTAL: ${money(o.pricing.total)}`);
      out.push("--------------------------------");
      out.push("DEMO ONLY ‚Ä¢ NOT REAL");
      return out.join("\n");
    }
    function openPrintWindow(text){
      const w = window.open("", "_blank", "width=560,height=740");
      if(!w){ alert("Popup blocked. Allow popups to print receipts."); return; }
      w.document.write(`
        <html><head><title>Receipt</title>
        <style>
          body{font-family: ui-monospace, Menlo, Consolas, monospace; padding:16px; white-space:pre-wrap;}
          .note{margin-top:12px; color:#444; font-family: system-ui, Arial;}
          button{padding:10px 12px; margin-top:12px; cursor:pointer;}
        </style></head><body>
${escapeHtml(text)}
<div class="note">DO NOT APPLY ‚Äî TESTING ONLY / DEMO ONLY</div>
<button onclick="window.print()">Print</button>
</body></html>
      `);
      w.document.close();
    }

    // =========================
    // QUEUE RENDER
    // =========================
    function renderQueue(){
      queueCount.textContent = String(orders.length);

      const filter = filterStatusEl.value;
      const q = orderSearchEl.value.trim().toLowerCase();

      const list = orders
        .slice()
        .sort((a,b)=> b.createdAt - a.createdAt)
        .filter(o => filter==="all" ? true : o.status===filter)
        .filter(o => {
          if(!q) return true;
          const blob = [
            o.oid, o.customer, o.type, o.status,
            ...(o.items||[]).map(i => `${i.name} ${i.note||""}`)
          ].join(" ").toLowerCase();
          return blob.includes(q);
        });

      ordersEl.innerHTML = list.length ? list.map(o => `
        <div class="order" data-oid="${o.oid}">
          <div class="order-top">
            <div>
              <div class="oid">#${o.oid} ‚Ä¢ ${escapeHtml(o.type)}${o.customer ? " ‚Ä¢ " + escapeHtml(o.customer) : ""}</div>
              <div class="mini">Placed: ${o.time} ‚Ä¢ Total: <strong style="color:#cfe1ff">${money(o.pricing.total)}</strong></div>
            </div>
            ${statusBadge(o.status)}
          </div>

          <ul class="olist">
            ${o.items.map(i=>`
              <li><strong>${i.qty}√ó</strong> ${escapeHtml(i.name)} ${i.note ? `<span class="mini">(Note: ${escapeHtml(i.note)})</span>`:""}</li>
            `).join("")}
          </ul>

          <div class="order-actions">
            <button class="btn secondary" type="button" data-act="prev">Back</button>
            <button class="btn good" type="button" data-act="next">Next</button>
            <button class="btn secondary" type="button" data-act="receipt">Receipt</button>
            <button class="btn bad" type="button" data-act="del">Delete</button>
          </div>
        </div>
      `).join("") : `<div class="mini">No orders found.</div>`;

      ordersEl.querySelectorAll(".order").forEach(card => {
        const oid = card.dataset.oid;
        card.querySelectorAll("button").forEach(b => {
          b.addEventListener("click", () => {
            const act = b.dataset.act;
            if(act==="next") advanceStatus(oid, +1);
            if(act==="prev") advanceStatus(oid, -1);
            if(act==="del") deleteOrder(oid);
            if(act==="receipt"){
              const o = orders.find(x=>x.oid===oid);
              if(o) openPrintWindow(buildReceiptTextForOrder(o));
            }
          });
        });
      });

      renderKitchen();
    }

    // =========================
    // KITCHEN RENDER (Approve + Clear)
    // =========================
    function renderKitchen(){
      const mode = kFilterEl.value;
      let list = orders.slice().sort((a,b)=> a.createdAt - b.createdAt);

      if(mode==="kitchen") list = list.filter(o => o.status==="new" || o.status==="progress");
      if(mode==="ready") list = list.filter(o => o.status==="ready");

      kOrdersEl.innerHTML = list.length ? list.map(o => `
        <div class="order" data-oid="${o.oid}">
          <div class="order-top">
            <div>
              <div class="oid">#${o.oid} ‚Ä¢ ${escapeHtml(o.type)}${o.customer ? " ‚Ä¢ " + escapeHtml(o.customer) : ""}</div>
              <div class="mini">Placed: ${o.time}</div>
            </div>
            ${statusBadge(o.status)}
          </div>

          <ul class="olist">
            ${o.items.map(i=>`
              <li><strong>${i.qty}√ó</strong> ${escapeHtml(i.name)} ${i.note ? `<span class="mini">(Note: ${escapeHtml(i.note)})</span>`:""}</li>
            `).join("")}
          </ul>

          <div class="order-actions">
            <button class="btn secondary" type="button" data-act="start">Start</button>
            <button class="btn good" type="button" data-act="ready">Ready</button>
            <button class="btn good" type="button" data-act="approve">Approve (Done)</button>
            <button class="btn bad" type="button" data-act="clear">Clear</button>
          </div>
        </div>
      `).join("") : `<div class="mini">No kitchen tickets right now.</div>`;

      kOrdersEl.querySelectorAll(".order").forEach(card => {
        const oid = card.dataset.oid;
        card.querySelectorAll("button").forEach(b => {
          b.addEventListener("click", () => {
            const act = b.dataset.act;
            if(act==="start") setStatus(oid, "progress");
            if(act==="ready") setStatus(oid, "ready");
            if(act==="approve") setStatus(oid, "done");     // ‚úÖ approve -> done
            if(act==="clear") deleteOrder(oid);             // üóëÔ∏è remove
          });
        });
      });
    }

    // =========================
    // SETTINGS
    // =========================
    function loadSettingsUI(){
      taxPctEl.value = Number(settings.taxPct||0).toFixed(2);
      feeAmtEl.value = Number(settings.feeAmt||0).toFixed(2);
      dingOnEl.checked = !!settings.dingOn;
      pauseOrdersEl.checked = !!settings.pauseOrders;
      placeOrderBtn.disabled = calcCart().lines.length === 0 || !!settings.pauseOrders;
    }
    function saveSettings(){
      settings.taxPct = clampNum(taxPctEl.value, 0, 25);
      settings.feeAmt = clampNum(feeAmtEl.value, 0, 9999);
      settings.dingOn = !!dingOnEl.checked;
      settings.pauseOrders = !!pauseOrdersEl.checked;
      saveJson(STORE.settings, settings);
      settingsPill.textContent = "Saved";
      renderCart();
      renderQueue();
    }
    function clampNum(v, min, max){
      const n = Number(v);
      if(Number.isNaN(n)) return min;
      return Math.max(min, Math.min(max, n));
    }

    // =========================
    // MANAGE ITEMS
    // =========================
    function openItems(){
      renderMenuTable();
      openModal(itemsBg);
    }
    function closeItems(){
      closeModal(itemsBg);
    }
    function clearItemForm(){
      miId.value = "";
      miCat.value = "";
      miName.value = "";
      miPrice.value = "";
      miDesc.value = "";
    }
    function renderMenuTable(){
      const rows = menu.slice().sort((a,b)=> (a.cat+a.name).localeCompare(b.cat+b.name));
      menuTable.innerHTML = `
        <tr>
          <th>ID</th><th>Category</th><th>Name</th><th>Price</th><th>Actions</th>
        </tr>
        ${rows.map(m => `
          <tr>
            <td>${escapeHtml(m.id)}</td>
            <td>${escapeHtml(m.cat)}</td>
            <td>${escapeHtml(m.name)}</td>
            <td>${money(m.price)}</td>
            <td>
              <button class="btn secondary" data-act="edit" data-id="${escapeHtml(m.id)}" type="button">Edit</button>
              <button class="btn bad" data-act="del" data-id="${escapeHtml(m.id)}" type="button">Delete</button>
            </td>
          </tr>
        `).join("")}
      `;

      menuTable.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          const act = btn.dataset.act;
          const id = btn.dataset.id;
          const item = menu.find(x=>x.id===id);
          if(!item) return;
          if(act==="edit"){
            miId.value = item.id;
            miCat.value = item.cat;
            miName.value = item.name;
            miPrice.value = item.price;
            miDesc.value = item.desc||"";
          }
          if(act==="del"){
            if(!confirm("Delete this item?")) return;
            menu = menu.filter(x=>x.id!==id);
            saveJson(STORE.menu, menu);
            renderCats();
            renderMenu();
            renderMenuTable();
          }
        });
      });
    }

    function saveItem(){
      const idRaw = miId.value.trim();
      const id = idRaw ? idRaw : uid("item");
      const catV = miCat.value.trim() || "Uncategorized";
      const nameV = miName.value.trim();
      const priceV = Number(miPrice.value);
      const descV = miDesc.value.trim();

      if(!nameV || !Number.isFinite(priceV) || priceV < 0){
        alert("Please enter a valid Name and Price.");
        return;
      }

      const existing = menu.find(x=>x.id===id);
      const newItem = {id, cat:catV, name:nameV, price:priceV, desc:descV};

      if(existing){
        Object.assign(existing, newItem);
      } else {
        menu.push(newItem);
      }

      saveJson(STORE.menu, menu);
      renderCats();
      renderMenu();
      renderMenuTable();
      clearItemForm();
    }

    // Restore default menu (overwrite)
    function restoreDefaultMenu(){
      if(!confirm("Restore default menu? This will overwrite your current menu list.")) return;
      menu = structuredClone(DEFAULT_MENU);
      saveJson(STORE.menu, menu);
      renderCats();
      renderMenu();
      renderMenuTable();
    }

    function wipeAllCustomItems(){
      if(!confirm("Delete ALL items and restore default menu?")) return;
      menu = structuredClone(DEFAULT_MENU);
      saveJson(STORE.menu, menu);
      renderCats();
      renderMenu();
      renderMenuTable();
    }

    // =========================
    // MANAGE COUPONS
    // =========================
    function openCoupons(){
      renderCouponTable();
      openModal(couponsBg);
    }
    function clearCouponForm(){
      cpCode.value = "";
      cpType.value = "percent";
      cpValue.value = "";
      cpMin.value = "";
      cpActive.value = "true";
    }
    function renderCouponTable(){
      const rows = coupons.slice().sort((a,b)=> normalizeCode(a.code).localeCompare(normalizeCode(b.code)));
      couponTable.innerHTML = `
        <tr>
          <th>Code</th><th>Type</th><th>Value</th><th>Min</th><th>Active</th><th>Actions</th>
        </tr>
        ${rows.map(c => `
          <tr>
            <td>${escapeHtml(normalizeCode(c.code))}</td>
            <td>${escapeHtml(c.type)}</td>
            <td>${c.type==="percent" ? escapeHtml(Number(c.value||0).toFixed(0)+"%") : money(Number(c.value||0))}</td>
            <td>${money(Number(c.min||0))}</td>
            <td>${c.active ? `<span class="pill ok">Yes</span>` : `<span class="pill no">No</span>`}</td>
            <td>
              <button class="btn secondary" data-act="edit" data-code="${escapeHtml(normalizeCode(c.code))}" type="button">Edit</button>
              <button class="btn bad" data-act="del" data-code="${escapeHtml(normalizeCode(c.code))}" type="button">Delete</button>
            </td>
          </tr>
        `).join("")}
      `;

      couponTable.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          const act = btn.dataset.act;
          const code = normalizeCode(btn.dataset.code);
          const c = findCoupon(code);
          if(!c) return;
          if(act==="edit"){
            cpCode.value = normalizeCode(c.code);
            cpType.value = c.type;
            cpValue.value = c.value;
            cpMin.value = c.min || 0;
            cpActive.value = String(!!c.active);
          }
          if(act==="del"){
            if(!confirm("Delete this coupon?")) return;
            coupons = coupons.filter(x => normalizeCode(x.code) !== code);
            saveJson(STORE.coupons, coupons);
            renderCouponTable();
            // If current applied coupon is deleted, clear it
            if(ui.coupon?.applied?.code && normalizeCode(ui.coupon.applied.code) === code){
              clearCoupon();
            }
            renderCart();
          }
        });
      });
    }

    function saveCoupon(){
      const code = normalizeCode(cpCode.value);
      const type = cpType.value;
      const value = Number(cpValue.value);
      const min = Number(cpMin.value || 0);
      const active = (cpActive.value === "true");

      if(!code){
        alert("Coupon code is required.");
        return;
      }
      if(!Number.isFinite(value) || value < 0){
        alert("Enter a valid coupon value.");
        return;
      }
      if(type === "percent" && value > 100){
        alert("Percent coupons should be 0‚Äì100.");
        return;
      }

      const existing = findCoupon(code);
      const obj = {code, type, value, min: Math.max(0, min||0), active};

      if(existing) Object.assign(existing, obj);
      else coupons.push(obj);

      saveJson(STORE.coupons, coupons);
      renderCouponTable();
      clearCouponForm();
      renderCart();
    }

    function restoreSampleCoupons(){
      if(!confirm("Restore sample coupons? This overwrites your coupon list.")) return;
      coupons = structuredClone(SAMPLE_COUPONS);
      saveJson(STORE.coupons, coupons);
      renderCouponTable();
      renderCart();
    }

    function wipeAllCoupons(){
      if(!confirm("Delete ALL coupons?")) return;
      coupons = [];
      saveJson(STORE.coupons, coupons);
      renderCouponTable();
      clearCoupon();
      renderCart();
    }

    // =========================
    // MODAL HELPERS
    // =========================
    function openModal(bg){
      bg.style.display = "flex";
      bg.setAttribute("aria-hidden","false");
    }
    function closeModal(bg){
      bg.style.display = "none";
      bg.setAttribute("aria-hidden","true");
    }

    // =========================
    // VIEW TOGGLE
    // =========================
    function setView(mode){
      if(mode==="pos"){
        viewPOS.classList.add("active");
        viewKitchen.classList.remove("active");
        posPanel.style.display = "";
        posRight.style.display = "";
        kitchenPanel.style.display = "none";
      }else{
        viewKitchen.classList.add("active");
        viewPOS.classList.remove("active");
        posPanel.style.display = "none";
        posRight.style.display = "none";
        kitchenPanel.style.display = "";
        renderKitchen();
      }
    }

    // =========================
    // EXPORT / IMPORT
    // =========================
    function openData(){
      openModal(dataBg);
    }
    function closeData(){
      closeModal(dataBg);
    }
    function fillExport(){
      const blob = {
        demo:true,
        version:1,
        exportedAt: new Date().toISOString(),
        menu, coupons, cart, orders, settings, counter, ui
      };
      dataBox.value = JSON.stringify(blob, null, 2);
    }
    function doImportData(){
      const raw = dataBox.value.trim();
      if(!raw){ alert("Paste JSON first."); return; }
      if(!confirm("Import will REPLACE your saved demo data. Continue?")) return;
      try{
        const blob = JSON.parse(raw);
        menu = Array.isArray(blob.menu) ? blob.menu : menu;
        coupons = Array.isArray(blob.coupons) ? blob.coupons : coupons;
        cart = Array.isArray(blob.cart) ? blob.cart : cart;
        orders = Array.isArray(blob.orders) ? blob.orders : orders;
        settings = (blob.settings && typeof blob.settings==="object") ? blob.settings : settings;
        counter = Number(blob.counter || counter);
        ui = (blob.ui && typeof blob.ui==="object") ? blob.ui : ui;

        saveJson(STORE.menu, menu);
        saveJson(STORE.coupons, coupons);
        saveJson(STORE.cart, cart);
        saveJson(STORE.orders, orders);
        saveJson(STORE.settings, settings);
        saveJson(STORE.counter, counter);
        saveJson(STORE.ui, ui);

        loadSettingsUI();
        loadUIFields();
        renderCats();
        renderMenu();
        renderCart();
        renderQueue();
        closeData();
      }catch{
        alert("Import failed: invalid JSON.");
      }
    }

    // =========================
    // UI LOAD/PERSIST
    // =========================
    function loadUIFields(){
      orderTypeEl.value = ui.orderType || "Dine-In";
      customerEl.value = ui.customer || "";
      couponCodeEl.value = ui.coupon?.applied?.code || ui.coupon?.code || "";
    }

    // =========================
    // BUTTON WIRES
    // =========================
    menuSearchEl.addEventListener("input", () => { menuSearch = menuSearchEl.value; renderMenu(); });

    applyCouponBtn.addEventListener("click", applyCoupon);
    clearCouponBtn.addEventListener("click", clearCoupon);
    couponCodeEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); applyCoupon(); } });

    clearCartBtn.addEventListener("click", ()=>{
      cart = [];
      saveJson(STORE.cart, cart);
      renderCart();
    });

    receiptCartBtn.addEventListener("click", ()=>{
      const {lines} = calcCart();
      if(!lines.length){ alert("Cart is empty."); return; }
      openPrintWindow(buildReceiptTextForCart());
    });

    placeOrderBtn.addEventListener("click", placeOrder);

    // settings
    defaultSettingsBtn.addEventListener("click", ()=>{
      settings = {taxPct:8.00, feeAmt:0.00, dingOn:true, pauseOrders:false};
      saveJson(STORE.settings, settings);
      loadSettingsUI();
      renderCart();
      renderQueue();
    });
    saveSettingsBtn.addEventListener("click", saveSettings);

    // queue tools
    filterStatusEl.addEventListener("change", renderQueue);
    orderSearchEl.addEventListener("input", renderQueue);
    clearCompletedBtn.addEventListener("click", ()=>{
      orders = orders.filter(o => o.status !== "done");
      saveJson(STORE.orders, orders);
      renderQueue();
    });

    // view
    viewPOS.addEventListener("click", ()=>setView("pos"));
    viewKitchen.addEventListener("click", ()=>setView("kitchen"));
    kFilterEl.addEventListener("change", renderKitchen);

    // manage items/coupons
    manageItemsBtn.addEventListener("click", openItems);
    manageCouponsBtn.addEventListener("click", openCoupons);

    itemsClose.addEventListener("click", closeItems);
    itemsBg.addEventListener("click", (e)=>{ if(e.target===itemsBg) closeItems(); });

    miClear.addEventListener("click", clearItemForm);
    miSave.addEventListener("click", saveItem);
    seedMenu.addEventListener("click", restoreDefaultMenu);
    wipeCustomMenu.addEventListener("click", wipeAllCustomItems);

    couponsClose.addEventListener("click", ()=>closeModal(couponsBg));
    couponsBg.addEventListener("click", (e)=>{ if(e.target===couponsBg) closeModal(couponsBg); });

    cpClear.addEventListener("click", clearCouponForm);
    cpSave.addEventListener("click", saveCoupon);
    seedCoupons.addEventListener("click", restoreSampleCoupons);
    wipeCoupons.addEventListener("click", wipeAllCoupons);

    // export/import
    exportBtn.addEventListener("click", ()=>{ openData(); fillExport(); });
    importBtn.addEventListener("click", ()=>{ openData(); dataBox.value=""; });
    dataClose.addEventListener("click", closeData);
    dataBg.addEventListener("click", (e)=>{ if(e.target===dataBg) closeData(); });
    doExport.addEventListener("click", fillExport);
    doImport.addEventListener("click", doImportData);

    // reset all
    resetBtn.addEventListener("click", ()=>{
      if(!confirm("Reset everything? This clears menu, coupons, orders, cart, settings, and counters.")) return;
      Object.values(STORE).forEach(k => localStorage.removeItem(k));
      menu = structuredClone(DEFAULT_MENU);
      coupons = structuredClone(SAMPLE_COUPONS);
      cart = [];
      orders = [];
      counter = 1000;
      settings = {taxPct:8.00, feeAmt:0.00, dingOn:true, pauseOrders:false};
      ui = {orderType:"Dine-In", customer:"", coupon:{code:"", applied:null}};
      saveJson(STORE.menu, menu);
      saveJson(STORE.coupons, coupons);
      saveJson(STORE.cart, cart);
      saveJson(STORE.orders, orders);
      saveJson(STORE.settings, settings);
      saveJson(STORE.counter, counter);
      saveJson(STORE.ui, ui);

      loadSettingsUI();
      loadUIFields();
      renderCats();
      renderMenu();
      renderCart();
      renderQueue();
      setView("pos");
    });

    // persist orderType/customer live
    orderTypeEl.addEventListener("change", ()=>{ ui.orderType = orderTypeEl.value; saveJson(STORE.ui, ui); });
    customerEl.addEventListener("input", ()=>{ ui.customer = customerEl.value; saveJson(STORE.ui, ui); });

    // =========================
    // INIT
    // =========================
    function init(){
      // load UI fields
      loadUIFields();

      // load settings UI
      loadSettingsUI();

      // default category
      cat = "All";

      renderCats();
      renderMenu();
      renderCart();
      renderQueue();
      setView("pos");
    }
    init();
  </script>
</body>
</html>
