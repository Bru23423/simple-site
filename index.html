<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fan Art Posts</title>
  <style>
    body { background: #121212; color: white; font-family: Arial; margin: 0; padding: 0; }
    .gallery { display: flex; flex-wrap: wrap; padding: 1em; gap: 1em; }
    .post { cursor: pointer; border: 1px solid #333; padding: 10px; background: #1e1e1e; border-radius: 10px; width: 200px; }
    .post img { width: 100%; border-radius: 8px; }

    /* Modal */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
             background: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center; }
    .modal-content { background: #222; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; }
    .comment { border-top: 1px solid #444; padding: 5px 0; }
    .like-btn { margin-top: 10px; cursor: pointer; color: #1e90ff; }
  </style>
</head>
<body>

  <h2 style="text-align:center; padding: 1em;">Fan Art Gallery</h2>

  <div class="gallery" id="gallery"></div>

  <div class="modal" id="postModal">
    <div class="modal-content">
      <span id="closeModal" style="float:right; cursor:pointer;">&times;</span>
      <h3 id="postOwner"></h3>
      <img id="modalImage" src="" style="width:100%; border-radius:8px;" />
      <div class="like-btn" id="likeBtn">❤️ Like (<span id="likeCount">0</span>)</div>

      <div style="margin-top: 1em;">
        <input type="text" id="commentInput" placeholder="Write a comment..." style="width: 100%;" />
        <button onclick="submitComment()">Comment</button>
      </div>
      <div id="comments" style="margin-top:1em;"></div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;
    let currentPostId = null;

    // Dummy login for this example
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        currentUser = user.displayName || user.email;
      } else {
        firebase.auth().signInAnonymously(); // For testing
      }
    });

    // Load posts
    const gallery = document.getElementById('gallery');
    firebase.database().ref('posts').on('value', snapshot => {
      gallery.innerHTML = '';
      snapshot.forEach(child => {
        const data = child.val();
        const post = document.createElement('div');
        post.className = 'post';
        post.innerHTML = `<img src="${data.image}" alt="Fan Art" /><div>${data.user}</div>`;
        post.onclick = () => openModal(child.key, data);
        gallery.appendChild(post);
      });
    });

    function openModal(postId, data) {
      currentPostId = postId;
      document.getElementById('modalImage').src = data.image;
      document.getElementById('postOwner').innerText = `Posted by: ${data.user}`;
      document.getElementById('postModal').style.display = 'flex';
      loadComments(postId);
      loadLikes(postId);
    }

    function loadComments(postId) {
      const commentsDiv = document.getElementById('comments');
      commentsDiv.innerHTML = '';
      firebase.database().ref('comments/' + postId).on('value', snapshot => {
        commentsDiv.innerHTML = '';
        snapshot.forEach(child => {
          const c = child.val();
          const div = document.createElement('div');
          div.className = 'comment';
          div.innerText = `${c.user}: ${c.text}`;
          commentsDiv.appendChild(div);
        });
      });
    }

    function submitComment() {
      const input = document.getElementById('commentInput');
      const text = input.value.trim();
      if (!text || !currentUser || !currentPostId) return;

      const commentData = {
        user: currentUser,
        text: text,
        timestamp: Date.now()
      };

      firebase.database().ref(`comments/${currentPostId}`).push(commentData);
      input.value = '';
    }

    function loadLikes(postId) {
      const likeCountSpan = document.getElementById('likeCount');
      firebase.database().ref(`likes/${postId}`).on('value', snapshot => {
        const likes = snapshot.val() || {};
        likeCountSpan.innerText = Object.keys(likes).length;
      });
    }

    document.getElementById('likeBtn').onclick = () => {
      if (!currentUser || !currentPostId) return;
      const likeRef = firebase.database().ref(`likes/${currentPostId}/${firebase.auth().currentUser.uid}`);
      likeRef.set(true);
    };

    document.getElementById('closeModal').onclick = () => {
      document.getElementById('postModal').style.display = 'none';
    };
  </script>
</body>
</html>

