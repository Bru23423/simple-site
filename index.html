<link rel="icon" href="favicon_bricklogo.png" type="image/png">
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Reddit-Like Demo</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; background: #f7f7f7; }
  h1 { text-align: center; }
  #loginSection, #registerSection, #postSection, #moderateSection, #postsSection {
    background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 0 5px #ccc;
  }
  label { display: block; margin-top: 10px; }
  input, textarea { width: 100%; padding: 8px; margin-top: 5px; }
  button { margin-top: 10px; padding: 10px; background: #007bff; border: none; color: white; border-radius: 5px; cursor: pointer; }
  button:hover { background: #0056b3; }
  .error { color: red; }
  .post { border-bottom: 1px solid #ddd; padding: 10px 0; }
  .post .author { font-weight: bold; }
  .post .content { margin: 5px 0; }
  .moderate-buttons button { margin-right: 5px; }
</style>
</head>
<body>

<h1>Simple Reddit-Like Demo</h1>

<div id="warning" style="color:red; text-align:center; font-weight:bold;">
  WARNING: This demo stores all data locally in your browser. Do NOT use real passwords!
</div>

<div id="loginSection">
  <h2>Login</h2>
  <label>Username:<input type="text" id="loginUsername" /></label>
  <label>Password:<input type="password" id="loginPassword" /></label>
  <button onclick="login()">Log In</button>
  <div id="loginError" class="error"></div>
</div>

<div id="registerSection">
  <h2>Register New Account</h2>
  <label>Username:<input type="text" id="registerUsername" /></label>
  <label>Password:<input type="password" id="registerPassword" /></label>
  <button onclick="register()">Register</button>
  <div id="registerError" class="error"></div>
</div>

<div id="welcomeSection" style="display:none;">
  <h2>Welcome, <span id="currentUser"></span>! <button onclick="logout()">Log Out</button></h2>

  <div id="postSection" style="display:none;">
    <h3>Create a Post</h3>
    <textarea id="postContent" rows="3" placeholder="Write your post here..."></textarea>
    <button onclick="createPost()">Submit Post</button>
    <div id="postError" class="error"></div>
  </div>

  <div id="moderateSection" style="display:none;">
    <h3>Moderate Posts</h3>
    <div id="pendingPosts"></div>
  </div>

  <div id="postsSection">
    <h3>Approved Posts</h3>
    <div id="approvedPosts"></div>
  </div>
</div>

<script>
  // Constants
  const MODERATOR_USERNAME = "moderator";
  const MODERATOR_PASSWORD = "modpass123";

  // Helpers: Save/load users and posts from localStorage
  function saveUsers(users) {
    localStorage.setItem('users', JSON.stringify(users));
  }
  function loadUsers() {
    let users = localStorage.getItem('users');
    if (!users) {
      // Create default moderator account on first load
      users = [{username: MODERATOR_USERNAME, password: MODERATOR_PASSWORD}];
      saveUsers(users);
      return users;
    }
    return JSON.parse(users);
  }

  function savePosts(posts) {
    localStorage.setItem('posts', JSON.stringify(posts));
  }
  function loadPosts() {
    let posts = localStorage.getItem('posts');
    if (!posts) {
      posts = [];
      savePosts(posts);
      return posts;
    }
    return JSON.parse(posts);
  }

  // State
  let currentUser = null;

  // UI Elements
  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const loginError = document.getElementById('loginError');
  const registerUsername = document.getElementById('registerUsername');
  const registerPassword = document.getElementById('registerPassword');
  const registerError = document.getElementById('registerError');
  const welcomeSection = document.getElementById('welcomeSection');
  const currentUserSpan = document.getElementById('currentUser');
  const postSection = document.getElementById('postSection');
  const postContent = document.getElementById('postContent');
  const postError = document.getElementById('postError');
  const moderateSection = document.getElementById('moderateSection');
  const pendingPostsDiv = document.getElementById('pendingPosts');
  const approvedPostsDiv = document.getElementById('approvedPosts');

  // Login function
  function login() {
    loginError.textContent = "";
    const username = loginUsername.value.trim();
    const password = loginPassword.value.trim();

    if (!username || !password) {
      loginError.textContent = "Please enter username and password.";
      return;
    }

    const users = loadUsers();
    const user = users.find(u => u.username === username && u.password === password);

    if (!user) {
      loginError.textContent = "Invalid username or password.";
      return;
    }

    currentUser = user.username;
    afterLogin();
  }

  // Register function
  function register() {
    registerError.textContent = "";
    const username = registerUsername.value.trim();
    const password = registerPassword.value.trim();

    if (!username || !password) {
      registerError.textContent = "Please enter username and password.";
      return;
    }

    if (username === MODERATOR_USERNAME) {
      registerError.textContent = "This username is reserved.";
      return;
    }

    const users = loadUsers();
    if (users.find(u => u.username === username)) {
      registerError.textContent = "Username already taken.";
      return;
    }

    users.push({username, password});
    saveUsers(users);

    alert("Account created! You can now log in.");
    registerUsername.value = "";
    registerPassword.value = "";
  }

  // After successful login
  function afterLogin() {
    loginUsername.value = "";
    loginPassword.value = "";
    loginError.textContent = "";

    registerUsername.value = "";
    registerPassword.value = "";
    registerError.textContent = "";

    document.getElementById('loginSection').style.display = "none";
    document.getElementById('registerSection').style.display = "none";
    welcomeSection.style.display = "block";
    currentUserSpan.textContent = currentUser;

    postSection.style.display = currentUser !== MODERATOR_USERNAME ? "block" : "none";
    moderateSection.style.display = currentUser === MODERATOR_USERNAME ? "block" : "none";

    renderPosts();
    renderPendingPosts();
  }

  // Logout function
  function logout() {
    currentUser = null;
    welcomeSection.style.display = "none";
    document.getElementById('loginSection').style.display = "block";
    document.getElementById('registerSection').style.display = "block";
  }

  // Create new post (pending approval)
  function createPost() {
    postError.textContent = "";
    const content = postContent.value.trim();
    if (!content) {
      postError.textContent = "Post content cannot be empty.";
      return;
    }

    let posts = loadPosts();
    posts.push({
      id: Date.now(),
      author: currentUser,
      content,
      approved: false,
      createdAt: new Date().toISOString()
    });
    savePosts(posts);
    postContent.value = "";
    alert("Post submitted for moderation.");
    renderPendingPosts();
  }

  // Render approved posts publicly
  function renderPosts() {
    let posts = loadPosts();
    approvedPostsDiv.innerHTML = "";
    posts.filter(p => p.approved).forEach(post => {
      const div = document.createElement('div');
      div.className = 'post';
      div.innerHTML = `
        <div class="author">${post.author} says:</div>
        <div class="content">${escapeHtml(post.content)}</div>
        <div class="date" style="font-size: 0.8em; color: #555;">${new Date(post.createdAt).toLocaleString()}</div>
      `;
      approvedPostsDiv.appendChild(div);
    });
  }

  // Render pending posts for moderator
  function renderPendingPosts() {
    if (currentUser !== MODERATOR_USERNAME) return;
    let posts = loadPosts();
    let pending = posts.filter(p => !p.approved);
    pendingPostsDiv.innerHTML = "";

    if (pending.length === 0) {
      pendingPostsDiv.textContent = "No posts to moderate.";
      return;
    }

    pending.forEach(post => {
      const div = document.createElement('div');
      div.className = 'post';
      div.innerHTML = `
        <div class="author">${post.author} (pending)</div>
        <div class="content">${escapeHtml(post.content)}</div>
        <div class="date" style="font-size: 0.8em; color: #555;">${new Date(post.createdAt).toLocaleString()}</div>
        <div class="moderate-buttons">
          <button onclick="approvePost(${post.id})">Approve</button>
          <button onclick="rejectPost(${post.id})">Reject</button>
        </div>
      `;
      pendingPostsDiv.appendChild(div);
    });
  }

  // Approve a post
  function approvePost(id) {
    let posts = loadPosts();
    let post = posts.find(p => p.id === id);
    if (post) {
      post.approved = true;
      savePosts(posts);
      renderPendingPosts();
      renderPosts();
    }
  }

  // Reject a post (delete it)
  function rejectPost(id) {
    let posts = loadPosts();
    posts = posts.filter(p => p.id !== id);
    savePosts(posts);
    renderPendingPosts();
  }

  // Simple HTML escape
  function escapeHtml(text) {
    return text
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // On page load, show login/register sections
  window.onload = () => {
    logout();
  };
</script>

</body>
</html>
