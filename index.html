<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adult Art Upload Site</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-6">
  <!-- Age Verification -->
  <div id="ageGate" class="text-center">
    <h1 class="text-3xl font-bold mb-4">This site contains adult content</h1>
    <p class="mb-6">You must be 18 years or older to continue.</p>
    <div class="space-x-4">
      <button onclick="agree()" class="bg-green-600 px-6 py-2 rounded hover:bg-green-700">Yes, I am 18+</button>
      <button onclick="window.location.href='https://www.google.com'" class="bg-red-600 px-6 py-2 rounded hover:bg-red-700">No, take me back</button>
    </div>
  </div>

  <!-- Auth/Login Section -->
  <div id="authSection" class="hidden max-w-md w-full space-y-4">
    <h2 class="text-2xl font-bold">Login or Sign Up</h2>
    <input id="email" type="email" placeholder="Email" class="w-full p-2 rounded bg-gray-800 text-white">
    <input id="password" type="password" placeholder="Password" class="w-full p-2 rounded bg-gray-800 text-white">
    <div class="flex space-x-4">
      <button onclick="login()" class="flex-1 bg-blue-600 px-4 py-2 rounded hover:bg-blue-700">Login</button>
      <button onclick="signup()" class="flex-1 bg-purple-600 px-4 py-2 rounded hover:bg-purple-700">Sign Up</button>
    </div>
  </div>

  <!-- Main App Section -->
  <div id="mainApp" class="hidden w-full max-w-4xl mt-10">
    <div class="mb-6 flex justify-between items-center">
      <h2 class="text-2xl font-bold">Upload Art</h2>
      <button onclick="logout()" class="text-red-500 hover:underline">Logout</button>
    </div>
    <input type="file" id="uploadFile" class="mb-2 text-black">
    <input type="text" id="caption" placeholder="Caption..." class="w-full p-2 rounded bg-gray-800 text-white mb-2">
    <input type="text" id="tags" placeholder="Tags (comma-separated)" class="w-full p-2 rounded bg-gray-800 text-white mb-2">
    <button onclick="uploadArt()" class="bg-green-600 px-4 py-2 rounded hover:bg-green-700">Upload</button>

    <input type="text" id="searchTags" oninput="searchByTag()" placeholder="Search by tags..." class="w-full p-2 rounded bg-gray-700 text-white mt-6">
    <hr class="my-6 border-gray-700">

    <div id="gallery" class="space-y-6"></div>
  </div>

  <script>
  const firebaseConfig = {
  apiKey: "AIzaSyBUazYAZZkL7Z6_zUhXHJC6FHc_lZVlua0",
  authDomain: "justfunit-c25dd.firebaseapp.com",
  databaseURL: "https://justfunit-c25dd-default-rtdb.firebaseio.com",
  projectId: "justfunit-c25dd",
  storageBucket: "justfunit-c25dd.firebasestorage.app",
  messagingSenderId: "340893927279",
  appId: "1:340893927279:web:9de690e1bfc33e09a30a9a"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const ageGate = document.getElementById('ageGate');
    const authSection = document.getElementById('authSection');
    const mainApp = document.getElementById('mainApp');
    let currentUser;

    function agree() {
      ageGate.style.display = 'none';
      authSection.style.display = 'block';
    }

    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password).then(() => initApp()).catch(err => alert(err.message));
    }

    function signup() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, password).then(() => initApp()).catch(err => alert(err.message));
    }

    function logout() {
      auth.signOut().then(() => location.reload());
    }

    function initApp() {
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          authSection.style.display = 'none';
          mainApp.style.display = 'block';
          loadGallery();
        }
      });
    }

    function uploadArt() {
      const file = document.getElementById('uploadFile').files[0];
      const caption = document.getElementById('caption').value;
      const tags = document.getElementById('tags').value.split(',').map(t => t.trim().toLowerCase());
      if (!file) return alert("Choose a file.");

      const ref = storage.ref('uploads/' + Date.now() + '-' + file.name);
      ref.put(file).then(snapshot => {
        ref.getDownloadURL().then(url => {
          db.collection('posts').add({
            url,
            caption,
            tags,
            user: currentUser.email,
            likes: [],
            views: [],
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
      });
    }

    function loadGallery(filteredTags = []) {
      db.collection('posts').orderBy("createdAt", "desc").onSnapshot(snapshot => {
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          if (filteredTags.length && !filteredTags.some(tag => data.tags.includes(tag))) return;
          const postId = doc.id;
          const isImage = data.url.match(/\.(jpeg|jpg|gif|png)$/i);
          const isLiked = data.likes.includes(currentUser.uid);

          const element = document.createElement('div');
          element.className = "bg-gray-800 p-4 rounded";
          element.innerHTML = `
            <p class="text-sm text-gray-400 mb-2">Uploaded by: ${data.user}</p>
            ${isImage ? `<img src="${data.url}" class="mb-2 max-h-96 mx-auto rounded">` :
              `<video src="${data.url}" controls class="mb-2 max-h-96 mx-auto rounded"></video>`}
            <p class="mb-2">${data.caption}</p>
            <p class="text-sm text-gray-500">Tags: ${data.tags.join(', ')}</p>
            <button onclick="likePost('${postId}')" class="${isLiked ? 'text-yellow-400' : 'text-white'}">❤️ ${data.likes.length}</button>
            <div id="comments-${postId}" class="mt-4 space-y-1"></div>
            <input type="text" id="comment-${postId}" placeholder="Add a comment..." class="w-full p-1 bg-gray-700 rounded mt-2">
            <button onclick="addComment('${postId}')" class="text-sm mt-1 text-blue-400">Post Comment</button>
          `;
          gallery.appendChild(element);
          loadComments(postId);
          trackView(postId, data.views);
        });
      });
    }

    function likePost(postId) {
      const postRef = db.collection('posts').doc(postId);
      postRef.get().then(doc => {
        const data = doc.data();
        let likes = data.likes || [];
        if (!likes.includes(currentUser.uid)) {
          likes.push(currentUser.uid);
          postRef.update({ likes });
        }
      });
    }

    function trackView(postId, views) {
      if (!views.includes(currentUser.uid)) {
        db.collection('posts').doc(postId).update({
          views: [...views, currentUser.uid]
        });
      }
    }

    function addComment(postId) {
      const commentInput = document.getElementById('comment-' + postId);
      const comment = commentInput.value;
      if (!comment) return;
      db.collection('posts').doc(postId).collection('comments').add({
        user: currentUser.email,
        text: comment,
        time: firebase.firestore.FieldValue.serverTimestamp()
      });
      commentInput.value = '';
    }

    function loadComments(postId) {
      db.collection('posts').doc(postId).collection('comments').orderBy("time", "asc").onSnapshot(snapshot => {
        const container = document.getElementById('comments-' + postId);
        container.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          const p = document.createElement('p');
          p.className = "text-sm text-gray-300";
          p.textContent = `${data.user}: ${data.text}`;
          container.appendChild(p);
        });
      });
    }

    function searchByTag() {
      const value = document.getElementById('searchTags').value.trim().toLowerCase();
      const tags = value.split(',').map(t => t.trim()).filter(Boolean);
      loadGallery(tags);
    }
  </script>
</body>
</html>
