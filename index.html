<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.6.1/firebase.js"></script>
</head>
<body>
    <h1>Sign In</h1>
    <button id="google-sign-in">Sign in with Google</button>
    <button id="apple-sign-in">Sign in with Apple</button>

    <div id="name-password-form" style="display:none;">
        <h2>Create your Profile</h2>
        <input type="text" id="username" placeholder="Enter your name" required>
        <input type="password" id="password" placeholder="Enter your password" required>
        <button id="submit-profile">Submit</button>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
  apiKey: "AIzaSyArz5gAM8rFOK8NiH2skrTFldVEiqkkbU8",
  authDomain: "justfunitcom.firebaseapp.com",
  projectId: "justfunitcom",
  storageBucket: "justfunitcom.firebasestorage.app",
  messagingSenderId: "12321079878",
  appId: "1:12321079878:web:301d5a953691b733278047"
};
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // Google sign-in
        document.getElementById('google-sign-in').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((result) => {
                // If the user is new, prompt to create a profile
                if (result.additionalUserInfo.isNewUser) {
                    showProfileForm(result.user);
                }
            }).catch((error) => {
                console.error(error.message);
            });
        });

        // Apple sign-in (this requires Firebase and Apple login setup in your Firebase console)
        document.getElementById('apple-sign-in').addEventListener('click', () => {
            const provider = new firebase.auth.OAuthProvider('apple.com');
            auth.signInWithPopup(provider).then((result) => {
                if (result.additionalUserInfo.isNewUser) {
                    showProfileForm(result.user);
                }
            }).catch((error) => {
                console.error(error.message);
            });
        });

        // Show profile creation form
        function showProfileForm(user) {
            document.getElementById('name-password-form').style.display = 'block';
            document.getElementById('submit-profile').addEventListener('click', () => {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username && password) {
                    // Update Firebase Authentication to set the password
                    user.updatePassword(password).then(() => {
                        // Store the user's name in Firestore
                        firestore.collection('users').doc(user.uid).set({
                            username: username
                        }).then(() => {
                            alert("Profile created successfully!");
                            // Redirect to another page or home page
                            window.location.href = 'home.html';
                        }).catch((error) => {
                            console.error("Error saving user data: ", error);
                        });
                    }).catch((error) => {
                        console.error("Error setting password: ", error);
                    });
                } else {
                    alert("Please fill out all fields.");
                }
            });
        }
    </script>
</body>
</html>
